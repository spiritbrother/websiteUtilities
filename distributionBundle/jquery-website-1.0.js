// Generated by CoffeeScript 1.6.3
/*
[Project page](https://thaibault.github.com/jQuery-website)

This module provides common logic for the whole web page.

Copyright
---------

Torben Sickert 16.12.2012

License
-------

This library written by Torben Sickert stand under a creative commons naming
3.0 unported license. see http://creativecommons.org/licenses/by/3.0/deed.de

Extending this module
---------------------

For conventions see require on https://github.com/thaibault/require

Author
------

t.sickert@gmail.com (Torben Sickert)

Version
-------

1.0 stable
*/


(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  (function($) {
    var Website, _ref;
    Website = (function(_super) {
      __extends(Website, _super);

      function Website() {
        _ref = Website.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      /*This plugin holds all needed methods to extend a whole website.*/


      /*
          **__name__ {String}**
          Holds the class name to provide inspection features.
      */


      Website.prototype.__name__ = 'Website';

      Website.prototype.initialize = function(options, _parentOptions, _viewportIsOnTop, _currentMediaQueryMode, languageHandler, __googleAnalyticsCode) {
        if (options == null) {
          options = {};
        }
        this._parentOptions = _parentOptions != null ? _parentOptions : {
          logging: false,
          domNodeSelectorPrefix: 'body.{1}',
          onViewportMovesToTop: $.noop(),
          onViewportMovesAwayFromTop: $.noop(),
          onChangeToDesktopMode: $.noop(),
          onChangeToTabletMode: $.noop(),
          onChangeToSmartphoneMode: $.noop(),
          onChangeMediaQueryMode: $.noop(),
          onSwitchSection: $.noop(),
          onStartUpAnimationComplete: $.noop(),
          additionalPageLoadingTimeInMilliseconds: 0,
          googleTrackingCode: 'UA-0-0',
          mediaQueryCssIndicator: {
            extraSmall: 'xs',
            small: 'sm',
            medium: 'md',
            large: 'lg'
          },
          domNode: {
            top: 'div.navigation-bar',
            scrollToTopButtons: 'a[href="#top"]',
            startUpAnimationClassPrefix: '.start-up-animation-number-',
            windowLoadingCover: '> div.window-loading-cover',
            windowLoadingSpinner: '> div.window-loading-cover > div'
          },
          startUpFadeIn: {
            easing: 'swing',
            duration: 'slow'
          },
          windowLoadingCoverFadeOut: {
            easing: 'swing',
            duration: 'slow'
          },
          startUpAnimationElementDelayInMiliseconds: 100,
          windowLoadingSpinner: {
            lines: 9,
            length: 23,
            width: 11,
            radius: 40,
            corners: 1,
            rotate: 75,
            color: '#000',
            speed: 1.1,
            trail: 58,
            shadow: false,
            hwaccel: false,
            className: 'spinner',
            zIndex: 2e9,
            top: 'auto',
            left: 'auto'
          },
          activateLanguageSupport: true,
          language: {},
          scrollInLinearTime: false,
          scrollToTop: {
            duration: 'slow'
          }
        };
        this._viewportIsOnTop = _viewportIsOnTop != null ? _viewportIsOnTop : true;
        this._currentMediaQueryMode = _currentMediaQueryMode != null ? _currentMediaQueryMode : '';
        this.languageHandler = languageHandler != null ? languageHandler : null;
        this.__googleAnalyticsCode = __googleAnalyticsCode != null ? __googleAnalyticsCode : '(function(i,s,o,g,r,a,m){i[\'GoogleAnalyticsObject\']=r;i[r]=i[r]||function(){\n(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\nm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n})(window,document,\'script\',\'//www.google-analytics.com/analytics.js\',\'ga\');\n\nga(\'create\', \'{1}\', \'archinstall.github.io\');\nga(\'send\', \'pageview\');';
        /*
            Initializes the interactive web application.
        
            **options {Object}**    - An options object.
        
            **returns {$.Website}** - Returns the current instance.
        */

        this._onViewportMovesToTop = this.debounce(this.getMethod(this._onViewportMovesToTop));
        this._onViewportMovesAwayFromTop = this.debounce(this.getMethod(this._onViewportMovesAwayFromTop));
        this._options = $.extend(true, {}, this._parentOptions, this._options);
        Website.__super__.initialize.call(this, options);
        this.$domNodes = this.grabDomNode(this._options.domNode);
        this._options.windowLoadingCoverFadeOut.always = this.getMethod(this._handleStartUpEffects);
        this.$domNodes.windowLoadingSpinner.spin(this._options.windowLoadingSpinner);
        this._bindScrollEvents().$domNodes.parent.show();
        this.$domNodes.window.ready(this.getMethod(this._removeLoadingCover));
        this._addNavigationEvents()._addMediaQueryChangeEvents()._triggerWindowResizeEvents()._handleGoogleAnalytics(this._options.trackingCode);
        if (this._options.language.logging == null) {
          this._options.language.logging = this._options.logging;
        }
        if (this._options.activateLanguageSupport) {
          this._languageHandler = $.Lang(this._options.language);
        }
        return this;
      };

      Website.prototype._onViewportMovesToTop = function() {
        /*
            This method triggers if the viewport moves to top.
        
            **returns {$.Website}** - Returns the current instance.
        */

        var _this = this;
        if (this.$domNodes.scrollToTopButtons.css('visibility') !== 'hidden') {
          this.$domNodes.scrollToTopButtons.animate({
            bottom: '+=30',
            opacity: 0
          }, {
            duration: 'normal',
            always: function() {
              return _this.$domNodes.scrollToTopButtons.css('bottom', '-=30');
            }
          });
        }
        return this;
      };

      Website.prototype._onViewportMovesAwayFromTop = function() {
        /*
            This method triggers if the viewport moves away from top.
        
            **returns {$.Website}** - Returns the current instance.
        */

        if (this.$domNodes.scrollToTopButtons.css('visibility') !== 'hidden') {
          this.$domNodes.scrollToTopButtons.css({
            bottom: '+=30',
            display: 'block',
            opacity: 0
          }).animate({
            bottom: '-=30',
            queue: false,
            opacity: 1
          }, {
            duration: 'normal'
          });
        }
        return this;
      };

      Website.prototype._onChangeMediaQueryMode = function(oldMode, newMode) {
        /*
            This method triggers if the responsive design switches to
            another mode.
        
            **oldMode {String}**    - Saves the previous mode.
        
            **newMode {String}**    - Saves the new mode.
        
            **returns {$.Website}** - Returns the current instance.
        */

        return this;
      };

      Website.prototype._onChangeToLargeMode = function(oldMode, newMode) {
        /*
            This method triggers if the responsive design switches to large
            mode.
        
            **oldMode {String}**    - Saves the previous mode.
        
            **newMode {String}**    - Saves the new mode.
        
            **returns {$.Website}** - Returns the current instance.
        */

        return this;
      };

      Website.prototype._onChangeToMediumMode = function(oldMode, newMode) {
        /*
            This method triggers if the responsive design switches to
            medium mode.
        
            **oldMode {String}**    - Saves the previous mode.
        
            **newMode {String}**    - Saves the new mode.
        
            **returns {$.Website}** - Returns the current instance.
        */

        return this;
      };

      Website.prototype._onChangeToSmallMode = function(oldMode, newMode) {
        /*
            This method triggers if the responsive design switches to small
            mode.
        
            **oldMode {String}**    - Saves the previous mode.
        
            **newMode {String}**    - Saves the new mode.
        
            **returns {$.Website}** - Returns the current instance.
        */

        return this;
      };

      Website.prototype._onChangeToExtraSmallMode = function(oldMode, newMode) {
        /*
            This method triggers if the responsive design switches to extra
            small mode.
        
            **oldMode {String}**    - Saves the previous mode.
        
            **newMode {String}**    - Saves the new mode.
        
            **returns {$.Website}** - Returns the current instance.
        */

        return this;
      };

      Website.prototype._onSwitchSection = function(sectionName) {
        /*
            This method triggers if we change the current section.
        
            **sectionName {String}** - Contains the new section name.
        
            **returns {$.Website}**  - Returns the current instance.
        */

        return this;
      };

      Website.prototype._onStartUpAnimationComplete = function() {
        /*
            This method is complete if last startup animation was
            initialized.
        
            **returns {$.Website}** - Returns the current instance.
        */

        return this;
      };

      Website.prototype._addMediaQueryChangeEvents = function() {
        /*
            This method adds triggers for responsive design switches.
        
            **returns {$.Website}** - Returns the current instance.
        */

        this.on(this.$domNodes.window, 'resize', this.getMethod(this._triggerWindowResizeEvents));
        return this;
      };

      Website.prototype._triggerWindowResizeEvents = function() {
        /*
            This method triggers if the responsive design switches its
            mode.
        
            **returns {$.Website}** - Returns the current instance.
        */

        var _this = this;
        $.each(this._options.mediaQueryCssIndicator, function(name, value) {
          _this.$domNodes.parent.addClass("hidden-" + value);
          if (_this.$domNodes.parent.is(':hidden') && name !== _this._currentMediaQueryMode) {
            _this.fireEvent.apply(_this, [_this.stringFormat('changeMediaQueryMode', name.substr(0, 1).toUpperCase() + name.substr(1)), false, _this, _this._currentMediaQueryMode, name].concat(_this.argumentsObjectToArray(arguments)));
            _this.fireEvent.apply(_this, [_this.stringFormat('changeTo{1}Mode', name.substr(0, 1).toUpperCase() + name.substr(1)), false, _this, _this._currentMediaQueryMode, name].concat(_this.argumentsObjectToArray(arguments)));
            _this._currentMediaQueryMode = name;
          }
          return _this.$domNodes.parent.removeClass("hidden-" + value);
        });
        return this;
      };

      Website.prototype._bindScrollEvents = function() {
        /*
            This method triggers if view port arrives at special areas.
        
            **returns {$.Website}** - Returns the current instance.
        */

        var _this = this;
        this.on(window, 'scroll', function() {
          if (_this.$domNodes.window.scrollTop()) {
            if (_this._viewportIsOnTop) {
              _this._viewportIsOnTop = false;
              return _this.fireEvent.apply(_this, ['viewportMovesAwayFromTop', false, _this].concat(_this.argumentsObjectToArray(arguments)));
            }
          } else if (!_this._viewportIsOnTop) {
            _this._viewportIsOnTop = true;
            return _this.fireEvent.apply(_this, ['viewportMovesToTop', false, _this].concat(_this.argumentsObjectToArray(arguments)));
          }
        });
        return this;
      };

      Website.prototype._removeLoadingCover = function() {
        /*
            This method triggers after window is loaded.
        
            **returns {$.Website}** - Returns the current instance.
        */

        var _this = this;
        window.setTimeout(function() {
          $(_this.stringFormat('[class^="{1}"], [class*=" {1}"]', _this.sliceDomNodeSelectorPrefix(_this._options.domNode.startUpAnimationClassPrefix).substr(1))).hide();
          return _this.$domNodes.windowLoadingCover.fadeOut(_this._options.windowLoadingCoverFadeOut);
        }, this._options.additionalPageLoadingTimeInMilliseconds);
        return this;
      };

      Website.prototype._handleStartUpEffects = function(elementNumber) {
        /*
            This method handles the given start up effect step.
        
            **elementNumber {Number}** - The current start up step.
        
            **returns {$.Website}**    - Returns the current instance.
        */

        var _this = this;
        this.$domNodes.windowLoadingSpinner.spin(false);
        if (!$.isNumeric(elementNumber)) {
          elementNumber = 1;
        }
        window.setTimeout((function() {
          $(_this._options.domNode.startUpAnimationClassPrefix + elementNumber).fadeIn(_this._options.startUpFadeIn);
          if ($(_this._options.domNode.startUpAnimationClassPrefix + (elementNumber + 1)).length) {
            return _this._handleStartUpEffects(elementNumber + 1);
          } else {
            return _this.fireEvent('startUpAnimationComplete');
          }
        }), this._options.startUpAnimationElementDelayInMiliseconds);
        return this;
      };

      Website.prototype._addNavigationEvents = function() {
        /*
            This method adds triggers to switch section.
        
            **returns {$.Website}** - Returns the current instance.
        */

        var _this = this;
        this.$domNodes.window.hashchange(function() {
          return _this.fireEvent('switchSection', false, _this, window.location.hash);
        });
        return this._handleScrollToTopButton();
      };

      Website.prototype._handleScrollToTopButton = function() {
        /*
            Adds trigger to scroll top buttons.
        
            **returns {$.Website}** - Returns the current instance.
        */

        var _this = this;
        this.on(this.$domNodes.scrollToTopButtons, 'click', function(event) {
          event.preventDefault();
          return _this._scrollToTop();
        });
        this.$domNodes.scrollToTopButtons.hide();
        return this;
      };

      Website.prototype._scrollToTop = function(onAfter) {
        var distanceToTopInPixel;
        if (onAfter == null) {
          onAfter = $.noop();
        }
        /*
            Scrolls to top of page. Runs the given function after viewport
            arrives.
        
            **onAfter {Function}**  - Callback to call after effect has
                                      finished.
        
            **returns {$.Website}** - Returns the current instance.
        */

        this._options.scrollToTop.onAfter = onAfter;
        if (this._options.scrollInLinearTime) {
          distanceToTopInPixel = this.$domNodes.window.scrollTop();
          this._options.scrollToTop.duration = distanceToTopInPixel;
          $.scrollTo({
            top: "-=" + distanceToTopInPixel,
            left: '+=0'
          }, this._options.scrollToTop);
        } else {
          $.scrollTo({
            top: 0,
            left: 0
          }, this._options.scrollToTop);
        }
        return this;
      };

      Website.prototype._handleGoogleAnalytics = function(trackingCode) {
        /*
            Scrolls to top of page. Runs the given function after viewport
            arrives.
        
            **trackingCode {String}** - Google's javaScript embedding code
                                        snippet.
        
            **returns {$.Website}**   - Returns the current instance.
        */

        var exception;
        alert('A');
        this.debug("Run analytics code: \"" + this.__googleAnalyticsCode + "\"", trackingCode);
        try {
          (new Function(this.stringFormat(this.__googleAnalyticsCode, trackingCode)))();
        } catch (_error) {
          exception = _error;
          this.warn('Problem in google analytics code snippet: {1}', exception);
        }
        return this;
      };

      return Website;

    })($.Tools["class"]);
    $.Website = function() {
      return $.Tools().controller(Website, arguments);
    };
    return $.Website["class"] = Website;
  })(this.jQuery);

}).call(this);
